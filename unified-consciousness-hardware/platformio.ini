; UCF Hardware Build Configuration v4.0.0
; Validated RRRR Lattice Implementation
;
; RRRR Lattice: Λ = {φ^{-r} · e^{-d} · π^{-c} · (√2)^{-a} : (r,d,c,a) ∈ ℤ⁴}
; Validation: 100% (20/20 tests)
; Free Parameters: ZERO

[platformio]
default_envs = esp32dev

; ============================================================================
; COMMON ESP32 CONFIGURATION (base environment)
; ============================================================================
[env]
platform = espressif32@6.4.0
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 921600

; Core libraries
lib_deps =
    adafruit/Adafruit MPR121@^1.1.1
    adafruit/Adafruit NeoPixel@^1.11.0
    adafruit/Adafruit BusIO@^1.14.1
    robtillaart/MCP_DAC@^0.2.1
    bblanchon/ArduinoJson@^6.21.3

; UCF v4.0.0 build flags (immutable constants)
build_flags =
    -DUCF_VERSION_MAJOR=4
    -DUCF_VERSION_MINOR=0
    -DUCF_VERSION_PATCH=0
    -DUCF_VALIDATION_PASS_RATE=100
    -DUCF_FREE_PARAMETERS=0
    -DRRRR_LATTICE_ENABLED=1
    -DK_FORMATION_ENABLED=1
    -DTRIAD_HYSTERESIS_ENABLED=1
    -I include/ucf
    -DPHI_CONSTANT=1.6180339887498948
    -DZ_CRITICAL_CONSTANT=0.8660254037844386

; Partition scheme for larger firmware
board_build.partitions = default.csv

; Monitor settings
monitor_filters = esp32_exception_decoder

; ============================================================================
; PRODUCTION BUILD
; ============================================================================
[env:esp32dev]
build_type = release
build_flags =
    ${env.build_flags}
    -DNDEBUG
    -DUCF_PRODUCTION=1
    -O2

; ============================================================================
; DEBUG BUILD
; ============================================================================
[env:esp32dev_debug]
build_type = debug
build_flags =
    ${env.build_flags}
    -DDEBUG_MODE=1
    -DUCF_VERBOSE_LOGGING=1
    -DLATTICE_VALIDATION_LOGGING=1
    -DCORE_DEBUG_LEVEL=5
    -Og

; ============================================================================
; VALIDATION BUILD
; ============================================================================
[env:esp32dev_validation]
build_type = release
build_flags =
    ${env.build_flags}
    -DVALIDATION_MODE=1
    -DRUN_20_TEST_SUITE=1
    -DUCF_VERBOSE_LOGGING=1
    -O2

; ============================================================================
; TEST BUILD
; ============================================================================
[env:esp32dev_test]
build_type = release
build_flags =
    ${env.build_flags}
    -DUNIT_TEST=1
    -DVALIDATION_MODE=1
    -O2
lib_deps =
    ${env.lib_deps}
    throwtheswitch/Unity@^2.5.2
test_framework = unity
test_build_src = yes

; ============================================================================
; CALIBRATION BUILD
; ============================================================================
[env:esp32dev_calibration]
build_type = release
build_flags =
    ${env.build_flags}
    -DUCF_CALIBRATION_MODE=1
    -DLATTICE_SEARCH_COMPLEXITY=3
    -DUCF_VERBOSE_LOGGING=1
    -O2

; ============================================================================
; NATIVE TEST (desktop simulation)
; Note: Native platform doesn't use board/framework, override inherited values
; ============================================================================
[env:native]
platform = native
board =
framework =
board_build.partitions =
monitor_filters =
build_flags =
    -std=c++17
    -DUNIT_TEST=1
    -DNATIVE_BUILD=1
    -I include/ucf
lib_deps =
    throwtheswitch/Unity@^2.5.2
test_framework = unity
